---
# cisco機器共通の処理を行う
- hosts:
    - l3switch
    - l2switch
  gather_facts: no
  tasks:
    - name: Remove unneeded banners
      ios_banner:
        banner: "{{ item }}"
        state: absent
      loop:
        - motd
        - exec
        - incoming

    - name: Update login banner
      ios_banner:
        banner: login
        text: |
          ----------------------------------------
          |
          | This banner was generated by Ansible
          |
          ----------------------------------------
          |
          | You are logged into {{ hostname }}
          |
          ----------------------------------------
        state: present

    - name: Enable service password-encryption
      ios_config:
        lines:
          - service password-encryption

    - name: configure hostname and domain name
      cisco.ios.ios_system:
        hostname: "{{ hostname }}"
        domain_name: "{{ domain_name }}"

    - name: configure buffer size
      cisco.ios.ios_logging:
        dest: buffered
        size: 409600

#    - name: config time
#      ios_config:
#        lines:
#          - ntp server ntp.nict.jp
#          - clock timezone JST 9
#          - service timestamps log datetime msec localtime show-timezone
#          - service timestamps debug datetime msec localtime show-timezone

    - name: Configure interfaces - Status and Descriptions
      cisco.ios.ios_vlans:
        config:
          - name: "{{ item.name }}"
            vlan_id: "{{ item.id }}"
            state: "{{ item.state }}"
            shutdown: "{{ item.shutdown }}"
            mtu: "{{ item.mtu }}"
        state: merged
      loop: "{{ vlans }}"

- import_playbook: ./l3switch.yml

- import_playbook: ./l2switch.yml

- hosts:
    - l3switch
    - l2switch
  gather_facts: no
  tasks:
    - name: save running to startup when modified
      cisco.ios.ios_config:
        save_when: modified
